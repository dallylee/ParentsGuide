---
import { Home, Briefcase, Calendar, FileText, BookOpen } from "lucide-astro";

const base = import.meta.env.BASE_URL;
const withBase = (path = "") => `${base}${path.replace(/^\//, "")}`;
const stripTrailingSlash = (path) => path.replace(/\/+$/, "");

const haloFor = (label) => {
  switch (label) {
    case "Home": return "rgba(34,197,94,0.55)";
    case "Your guide": return "rgba(147,197,253,0.55)";
    case "Tools": return "rgba(253,186,116,0.55)";
    case "Timeline": return "rgba(167,139,250,0.55)";
    case "Notes": return "rgba(244,114,182,0.55)";
    default: return "rgba(148,163,184,0.45)";
  }
};

const currentPath = stripTrailingSlash(Astro.url.pathname);
const homePath = stripTrailingSlash(withBase("/"));

const navItems = [
  { href: withBase("/"), label: "Home", icon: Home },
  { href: withBase("section/start/"), label: "Your guide", icon: BookOpen },
  { href: withBase("tools/"), label: "Tools", icon: Briefcase },
  { href: withBase("section/timeline/"), label: "Timeline", icon: Calendar },
  { href: withBase("notes/"), label: "Notes", icon: FileText },
];
---

<nav aria-label="Primary" class="site-bottom-nav fixed bottom-0 left-0 right-0 z-40 bg-white/90 backdrop-blur border-t border-gray-100">
  <!-- Incoming container kept -->
  <div class="grid h-16 max-w-2xl w-full grid-cols-5 mx-auto">
    {navItems.map(({ href, label, icon: Icon }) => {
      const hrefPath = stripTrailingSlash(href);
      const isActive = currentPath === hrefPath || (hrefPath !== homePath && currentPath.startsWith(hrefPath));
      return (
        <a
          href={href}
          class:list={[
            "flex flex-col items-center justify-center w-full h-full space-y-1 no-underline",
            isActive ? "text-gray-900" : "text-gray-600 hover:text-gray-800"
          ]}
          aria-label={label}
        >
          <span class:list={["icon-wrap", isActive ? "is-active" : "is-inactive"]} style={`--halo:${haloFor(label)};`}>
            <span class="icon-halo" aria-hidden="true"></span>
            <Icon class="icon-svg" size={24} stroke-width={isActive ? 2.5 : 2} stroke="currentColor" fill="currentColor" />
          </span>
          <span class:list={["text-xs leading-tight font-medium whitespace-nowrap", isActive ? "text-gray-900" : "text-gray-600"]}>
            {label}
          </span>
        </a>
      );
    })}
  </div>
</nav>

<style>
  .icon-wrap {
    position: relative;
    width: 34px;
    height: 34px;
    display: grid;
    place-items: center;
  }
  .icon-halo {
    position: absolute;
    inset: -6px;
    border-radius: 12px;
    background: radial-gradient(circle at 50% 55%, var(--halo) 0%, rgba(0,0,0,0) 68%);
    opacity: 0.55;
    filter: blur(6px);
    pointer-events: none;
    transform: translateZ(0);
  }
  .icon-svg {
    position: relative;
    z-index: 1;
    display: block;
  }
  .icon-wrap.is-inactive .icon-halo {
    opacity: 0.25;
    filter: blur(7px);
  }
  .icon-wrap.is-active .icon-halo {
    opacity: 0.75;
    filter: blur(6px);
  }
</style>
