---
import { Home, Briefcase, Calendar, FileText, BookOpen } from 'lucide-astro';

const base = import.meta.env.BASE_URL;
const withBase = (path = "") => `${base}${path.replace(/^\//, "")}`;
const stripTrailingSlash = (path) => (path !== '/' && path.endsWith('/')) ? path.slice(0, -1) : path;

const pathname = new URL(Astro.request.url).pathname;
const currentPath = stripTrailingSlash(pathname);
const homePath = stripTrailingSlash(withBase(''));

const navItems = [
    { href: withBase(''), label: 'Home', icon: Home },
    { href: withBase('section/start/'), label: 'Your guide', icon: BookOpen },
    { href: withBase('tools/'), label: 'Tools', icon: Briefcase },
    { href: withBase('section/timeline/'), label: 'Timeline', icon: Calendar },
    { href: withBase('notes/'), label: 'Notes', icon: FileText },
];
---

<nav id="bottom-nav" class="fixed bottom-0 left-0 right-0 z-50 bg-white border-t border-gray-100 pb-safe">
  <div class="flex justify-around items-center h-16 max-w-md mx-auto">
      {navItems.map(({ href, label, icon: Icon }) => {
        const hrefPath = stripTrailingSlash(href);
        const isActive = currentPath === hrefPath || (hrefPath !== homePath && currentPath.startsWith(hrefPath));
        return (
        <a
            href={href}
            class:list={[
                "flex flex-col items-center justify-center w-full h-full space-y-1 transition-colors duration-200 text-slate-800",
                isActive ? "text-slate-900" : "opacity-90 hover:text-slate-900"
            ]}
            aria-label={label}
        >
          <span class:list={["nav-icon", isActive ? "nav-icon-active" : "nav-icon-inactive"]}>
            <Icon size={24} stroke-width={isActive ? 2.5 : 2} stroke="currentColor" fill="currentColor" />
          </span>
          <span class:list={["text-[10px] font-medium", isActive ? "text-slate-900" : "text-slate-800"]}>{label}</span>
        </a>
      );
    })}
  </div>
</nav>

<style>
    .nav-icon {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        opacity: 0.95;
        transition: opacity 200ms ease, filter 200ms ease;
        filter: drop-shadow(0 0 6px rgba(0, 0, 0, 0.12));
    }

    .nav-icon-active {
        opacity: 1;
        filter: drop-shadow(0 0 10px rgba(0, 0, 0, 0.16));
    }

    .nav-icon-inactive {
        opacity: 0.85;
    }

    /* Safe area padding for iPhone X+ */
    .pb-safe {
        padding-bottom: env(safe-area-inset-bottom);
    }
</style>
