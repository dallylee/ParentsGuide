---
import { getCollection } from 'astro:content';
import Layout from '../../layouts/Layout.astro';
import Card from '../../components/Card.astro';

export async function getStaticPaths() {
  const guideEntries = await getCollection('guide');
  return guideEntries.map(entry => ({
    params: { slug: entry.slug }, props: { entry },
  }));
}

const { entry } = Astro.props;
const { Content } = await entry.render();

// Get next/prev chapters for navigation
const guideEntries = await getCollection('guide');
guideEntries.sort((a, b) => a.data.order - b.data.order);
const currentIndex = guideEntries.findIndex(e => e.slug === entry.slug);
const prevEntry = currentIndex > 0 ? guideEntries[currentIndex - 1] : null;
const nextEntry = currentIndex < guideEntries.length - 1 ? guideEntries[currentIndex + 1] : null;
const base = import.meta.env.BASE_URL;
const withBase = (path = "") => `${base}${path.replace(/^\//, "")}`;
const glows = [
    'rgba(207, 232, 255, 0.75)',
    'rgba(255, 227, 216, 0.7)',
    'rgba(230, 255, 216, 0.7)',
    'rgba(245, 232, 255, 0.75)'
];
---

<Layout title={entry.data.title}>
	<div class="min-h-screen bg-slate-50">
		{/* Header */}
		<header class="bg-white shadow-sm sticky top-0 z-50">
			<div class="max-w-3xl mx-auto px-4 h-16 flex items-center justify-between">
                                <a href={withBase('')} class="text-slate-500 hover:text-blue-600 flex items-center text-sm font-medium transition-colors">
					<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-4 h-4 mr-1">
						<path stroke-linecap="round" stroke-linejoin="round" d="M10.5 19.5L3 12m0 0l7.5-7.5M3 12h18" />
					</svg>
					Back to Guide
				</a>
				<span class="text-xs font-bold bg-blue-100 text-blue-700 px-2 py-1 rounded-full uppercase">
					Chapter {entry.data.order}
				</span>
			</div>
		</header>

                <main class="max-w-3xl mx-auto px-6 py-10">
                        <Card as="article" class="prose prose-slate prose-lg max-w-none p-8 md:p-12" style={`--glow: ${glows[0]}`}>
                                <Content />
                        </Card>

                        {/* Navigation Footer */}
                        <div class="mt-8 grid grid-cols-2 gap-4">
                                {prevEntry ? (
                                        <Card as="a" href={withBase(`guide/${prevEntry.slug}`)} class="p-4 transition group" style={`--glow: ${glows[1]}`}>
                                                <span class="block text-xs text-slate-400 uppercase tracking-wide mb-1">Previous</span>
                                                <span class="block text-slate-700 font-medium group-hover:text-blue-600">{prevEntry.data.title}</span>
                                        </Card>
                                ) : (
                                        <div />
                                )}

                                {nextEntry ? (
                                        <Card as="a" href={withBase(`guide/${nextEntry.slug}`)} class="p-4 text-right transition group" style={`--glow: ${glows[2]}`}>
                                                <span class="block text-xs text-slate-400 uppercase tracking-wide mb-1">Next</span>
                                                <span class="block text-slate-700 font-medium group-hover:text-blue-600">{nextEntry.data.title}</span>
                                        </Card>
				) : (
					<div />
				)}
			</div>
		</main>
	</div>
</Layout>
